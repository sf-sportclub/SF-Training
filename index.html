<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>SF Sport club Run Challenge 2025 (‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà)</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: { extend: { fontFamily: { sans: ['Inter','sans-serif'] } } }
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    ::-webkit-scrollbar{ width:8px;background:#f0f4f8;}
    ::-webkit-scrollbar-thumb{ background:#94a3b8;border-radius:10px;border:2px solid #f0f4f8;}
    ::-webkit-scrollbar-thumb:hover{ background:#64748b;}
    body{ font-family:'Inter',sans-serif;}
    input[type="text"],input[type="date"],input[type="number"],select,textarea{
      font-size:1rem;padding:.75rem 1rem;
    }
    @media (min-width:640px){
      input[type="text"],input[type="date"],input[type="number"],select,textarea{
        font-size:.875rem;padding:.5rem .75rem;
      }
    }
  </style>
</head>
<body class="bg-[url('https://firebasestorage.googleapis.com/v0/b/pichayut-40dd2.firebasestorage.app/o/painting-mountain-lake-with-mountain-background.jpg?alt=media&token=c15af5c2-411e-4249-88f6-057d956b1238')] bg-cover bg-center bg-fixed flex flex-col min-h-screen">

  <div class="flex-grow container mx-auto p-4 sm:p-6 lg:p-8">
    <div class="max-w-xl mx-auto bg-white/90 rounded-3xl shadow-xl p-6 sm:p-8">
      <h1 class="text-3xl sm:text-4xl font-extrabold text-center text-slate-800 mb-2">
        SF Sport club Run Challenge 2025 (‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà)
      </h1>
      <p class="text-center text-slate-500 mb-8">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πà‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</p>

      <button id="showRulesBtn" class="w-full flex justify-center py-3 px-4 mb-6 rounded-xl shadow-sm text-base font-bold text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors">üìú ‡∏≠‡πà‡∏≤‡∏ô‡∏Å‡∏é‡πÅ‡∏•‡∏∞‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πà‡∏á üèÉ‚Äç‚ôÇÔ∏è</button>

      <form id="runChallengeForm" class="space-y-6">
        <div>
          <label for="teamName" class="block font-medium text-slate-700">‡∏ó‡∏µ‡∏°</label>
          <select id="teamName" name="teamName" required class="mt-1 block w-full px-3 py-2 border border-slate-300 rounded-xl shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏° --</option>
            <option value="‡∏ó‡∏µ‡∏° ‡∏ü‡∏≤‡πÜ">‡∏ó‡∏µ‡∏° ‡∏ü‡∏≤‡πÜ</option>
            <option value="‡∏ó‡∏µ‡∏°‡∏°‡∏≤‡πÜ">‡∏ó‡∏µ‡∏°‡∏°‡∏≤‡πÜ</option>
            <option value="‡∏ó‡∏µ‡∏°‡πÄ‡∏à‡πÜ‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å">‡∏ó‡∏µ‡∏°‡πÄ‡∏à‡πÜ‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å</option>
          </select>
        </div>

        <div>
          <label for="fullName" class="block font-medium text-slate-700">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡∏ú‡∏•‡∏ß‡∏¥‡πà‡∏á)</label>
          <input type="text" id="fullName" name="fullName" required class="mt-1 block w-full px-3 py-2 border border-slate-300 rounded-xl shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
        </div>

        <div>
          <label for="runningDate" class="block font-medium text-slate-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡πà‡∏á</label>
          <input type="date" id="runningDate" name="runningDate" required class="mt-1 block w-full px-3 py-2 border border-slate-300 rounded-xl shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
        </div>

        <div>
          <label for="distance" class="block font-medium text-slate-700">‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡πà‡∏á (‡∏Å‡∏¥‡πÇ‡∏•‡πÄ‡∏°‡∏ï‡∏£)</label>
          <input type="number" id="distance" name="distance" step="0.01" min="0" required class="mt-1 block w-full px-3 py-2 border border-slate-300 rounded-xl shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
        </div>

        <div>
          <label for="imageProof" class="block font-medium text-slate-700">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏†‡∏≤‡∏û <span class="text-red-500">*</span></label>
          <p class="text-sm text-slate-500 mt-1 mb-2">‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á / ‡πÄ‡∏ß‡∏•‡∏≤ / ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô</p>
          <input type="file" id="imageProof" name="imageProof" accept="image/*" required class="mt-1 block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
          <div id="imagePreviewContainer" class="mt-4 hidden">
            <p class="font-medium text-slate-700 mb-2">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î:</p>
            <img id="imagePreview" src="#" alt="Image Proof Preview" class="w-full h-auto max-h-64 object-contain rounded-xl shadow-md">
          </div>
        </div>

        <div>
          <label for="notes" class="block font-medium text-slate-700">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
          <textarea id="notes" name="notes" rows="3" class="mt-1 block w-full px-3 py-2 border border-slate-300 rounded-xl shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></textarea>
        </div>

        <div>
          <button type="submit" id="submitBtn" class="w-full flex justify-center py-3 px-4 rounded-xl shadow-sm text-base font-bold text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏ß‡∏¥‡πà‡∏á
          </button>
        </div>
      </form>
    </div>
  </div>

  <footer class="bg-white/90 text-center p-4 shadow-inner text-slate-500 text-sm mt-8">
    ¬© Copyright <span id="currentYear"></span>, SF Sport club
  </footer>

  <script>
    document.getElementById('currentYear').textContent = new Date().getFullYear();

    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycby026QxfGpPDs4Ys5TGB-e-AvTfKbMZPcXCm2h3RQb5ebEt22gTJeIeVQMZ0LdwFz1-6w/exec"; // ‚Üê ‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

    const form = document.getElementById('runChallengeForm');
    const submitBtn = document.getElementById('submitBtn');
    const imageInput = document.getElementById('imageProof');
    const imagePreview = document.getElementById('imagePreview');
    const imagePreviewContainer = document.getElementById('imagePreviewContainer');
    const showRulesBtn = document.getElementById('showRulesBtn');

    const rulesContent = `... (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° ‡∏¢‡πà‡∏≠‡πÑ‡∏î‡πâ) ...`;

    showRulesBtn.addEventListener('click', () => {
      Swal.fire({ title: '‡∏Å‡∏é‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô', html: rulesContent, width: '90%', showCloseButton: true, confirmButtonText: '‡∏õ‡∏¥‡∏î' });
    });

    imageInput.addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          imagePreview.src = e.target.result;
          imagePreviewContainer.classList.remove('hidden');
        };
        reader.readAsDataURL(file);
      } else {
        imagePreviewContainer.classList.add('hidden');
        imagePreview.src = '#';
      }
    });

    form.addEventListener('submit', async (event) => {
      event.preventDefault();

      // disabled ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏î‡∏ã‡πâ‡∏≥
      submitBtn.disabled = true;
      submitBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
      Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });

      try {
        const formData = new FormData(form);
        const file = formData.get('imageProof');

        // ‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏õ‡πá‡∏ô base64 dataURL
        const dataURL = await new Promise((resolve, reject) => {
          const r = new FileReader();
          r.onload = () => resolve(r.result);
          r.onerror = reject;
          r.readAsDataURL(file);
        });

        const payload = {
          __origin: window.location.origin, // ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏•‡∏∑‡∏≠‡∏Å CORS origin ‡∏ù‡∏±‡πà‡∏á GAS
          team: formData.get('teamName'),
          name: formData.get('fullName'),
          date: formData.get('runningDate'),
          distance: formData.get('distance'),
          note: formData.get('notes'),
          fileData: dataURL,
          fileName: file.name
        };

        const res = await fetch(WEB_APP_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)   // ‡∏≠‡∏¢‡πà‡∏≤‡πÉ‡∏ä‡πâ mode:'no-cors' ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏à‡∏∞‡∏≠‡πà‡∏≤‡∏ô response ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
        });

        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const json = await res.json();

        submitBtn.disabled = false;
        submitBtn.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏ß‡∏¥‡πà‡∏á';
        form.reset();
        imagePreviewContainer.classList.add('hidden');

        if (json.status === "success") {
          Swal.fire({ icon: 'success', title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', text: json.message, confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á' });
        } else {
          Swal.fire({ icon: 'error', title: '‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!', text: json.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ', confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á' });
        }
      } catch (err) {
        submitBtn.disabled = false;
        submitBtn.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏ß‡∏¥‡πà‡∏á';
        Swal.fire({ icon: 'error', title: '‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!', text: String(err), confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á' });
      }
    });
  </script>
</body>
</html>
