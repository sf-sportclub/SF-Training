<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>SF Sport club Run Challenge 2025 (สำนักงานใหญ่)</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { theme: { extend: { fontFamily: { sans: ['Inter','sans-serif'] } } } };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-gray-100 flex flex-col min-h-screen">

  <div class="flex-grow container mx-auto p-4 sm:p-6 lg:p-8">
    <div class="max-w-xl mx-auto bg-white rounded-3xl shadow-xl p-6 sm:p-8">
      <h1 class="text-3xl sm:text-4xl font-extrabold text-center text-slate-800 mb-2">
        SF Sport club Run Challenge 2025 (สำนักงานใหญ่)
      </h1>
      <p class="text-center text-slate-500 mb-8">บันทึกผลการวิ่งสำหรับสมาชิก</p>

      <!-- ฟอร์มส่งตรงไปยัง GAS -->
      <form id="runChallengeForm"
            method="POST"
            action="https://script.google.com/macros/s/AKfycbxpT3UJQ11l10z6rCQT_lxeuiwd-LsyX6uHnyuYZYzNpybAqWjN1wNYiAtSCAMpLz8NxA/exec"
            enctype="multipart/form-data"
            target="uploadFrame"
            class="space-y-6">

        <div>
          <label class="block font-medium text-slate-700">ทีม</label>
          <select name="teamName" required class="mt-1 block w-full border border-slate-300 rounded-xl px-3 py-2">
            <option value="">-- เลือกทีม --</option>
            <option value="ทีม ฟาๆ">ทีม ฟาๆ</option>
            <option value="ทีมมาๆ">ทีมมาๆ</option>
            <option value="ทีมเจๆน่ารัก">ทีมเจๆน่ารัก</option>
          </select>
        </div>

        <div>
          <label class="block font-medium text-slate-700">ชื่อ-นามสกุล</label>
          <input type="text" name="fullName" required class="mt-1 block w-full border border-slate-300 rounded-xl px-3 py-2">
        </div>

        <div>
          <label class="block font-medium text-slate-700">วันที่วิ่ง</label>
          <input type="date" name="runningDate" required class="mt-1 block w-full border border-slate-300 rounded-xl px-3 py-2">
        </div>

        <div>
          <label class="block font-medium text-slate-700">ระยะทาง (กม.)</label>
          <input type="number" name="distance" step="0.01" min="0" required class="mt-1 block w-full border border-slate-300 rounded-xl px-3 py-2">
        </div>

        <div>
          <label class="block font-medium text-slate-700">อัปโหลดหลักฐานภาพ</label>
          <input type="file" name="imageProof" accept="image/*" required class="mt-1 block w-full">
        </div>

        <div>
          <label class="block font-medium text-slate-700">หมายเหตุเพิ่มเติม</label>
          <textarea name="notes" rows="3" class="mt-1 block w-full border border-slate-300 rounded-xl px-3 py-2"></textarea>
        </div>

        <button type="submit" id="submitBtn"
                class="w-full py-3 rounded-xl text-white bg-blue-600 hover:bg-blue-700 font-bold">
          บันทึกผลวิ่ง
        </button>
      </form>

      <!-- iframe ซ่อน -->
      <iframe name="uploadFrame" id="uploadFrame" style="display:none;"></iframe>
    </div>
  </div>

  <footer class="bg-white text-center p-4 text-slate-500 text-sm mt-8">
    © <span id="currentYear"></span>, SF Sport club
  </footer>

  <script>
    document.getElementById('currentYear').textContent = new Date().getFullYear();
    const form = document.getElementById('runChallengeForm');
    const submitBtn = document.getElementById('submitBtn');

    form.addEventListener('submit', () => {
      submitBtn.disabled = true;
      submitBtn.textContent = 'กำลังบันทึก...';
      Swal.fire({ title: 'กำลังบันทึกข้อมูล...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });
    });

    // รับผลลัพธ์จาก Apps Script (ส่งมาทาง postMessage)
    window.addEventListener('message', (event) => {
      submitBtn.disabled = false;
      submitBtn.textContent = 'บันทึกผลวิ่ง';
      Swal.close();

      const data = event.data;
      if (data && data.status === "success") {
        form.reset();
        Swal.fire({ icon: 'success', title: 'สำเร็จ!', text: data.message, confirmButtonText: 'ตกลง' });
      } else {
        Swal.fire({ icon: 'error', title: 'ผิดพลาด!', text: data?.message || 'ไม่สามารถบันทึกได้', confirmButtonText: 'ตกลง' });
      }
    });
  </script>
</body>
</html>
