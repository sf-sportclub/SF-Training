<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ลงทะเบียนเพื่อเข้าอบรม Excel</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
    body::before{
      content:''; position:fixed; inset:0;
      background-image:url('https://i.postimg.cc/dQfN4kHR/image.png');
      background-size:cover; background-position:center; background-attachment:fixed;
      filter:blur(3px); opacity:.7; z-index:-1;
    }
    .content-container{ position:relative; z-index:10; }
    .registration-box{ background:#ffffff; }
    .hidden{ display:none; }
  </style>
</head>
<body class="flex items-center justify-center min-h-screen">

  <!-- โลโก้ -->
  <div class="absolute top-4 right-4 z-20">
    <img src="https://i.postimg.cc/q7fGWSWj/SF-Logo-2.png" alt="Logo" style="width:50px;height:auto;">
  </div>

  <div class="registration-box p-8 md:p-12 rounded-3xl shadow-2xl max-w-lg w-full m-4 border border-gray-100 bg-opacity-90 content-container">
    <div class="text-center mb-8">
      <h1 class="text-2xl md:text-3xl font-bold text-gray-900">Register</h1>
      <p class="mt-1 text-xl md:text-2xl font-bold text-gray-800">Basic & Intermediate Level</p>
      <p class="mt-4 text-sm text-gray-500">กรุณากรอกข้อมูลส่วนบุคคลตามจริงเพื่อบันทึกประวัติ</p>
      <p class="text-red-500 text-xs mt-1">(*ที่นั่งมีจำนวนจำกัด)</p>
    </div>

    <form id="registrationForm" class="space-y-6" autocomplete="off">
      <!-- คำนำหน้า -->
      <div>
        <label class="block text-base font-medium text-gray-700">คำนำหน้า <span class="text-red-500">*</span></label>
        <div class="mt-2 grid grid-cols-2 sm:grid-cols-4 gap-4">
          <label class="flex items-center">
            <input type="radio" name="prefix" value="นาย" class="h-5 w-5 text-indigo-600 focus:ring-indigo-500" required>
            <span class="ml-2 text-base text-gray-700">นาย</span>
          </label>
          <label class="flex items-center">
            <input type="radio" name="prefix" value="นางสาว" class="h-5 w-5 text-indigo-600 focus:ring-indigo-500">
            <span class="ml-2 text-base text-gray-700">นางสาว</span>
          </label>
          <label class="flex items-center">
            <input type="radio" name="prefix" value="นาง" class="h-5 w-5 text-indigo-600 focus:ring-indigo-500">
            <span class="ml-2 text-base text-gray-700">นาง</span>
          </label>
          <label class="flex items-center">
            <input type="radio" name="prefix" value="อื่นๆ" id="otherPrefix" class="h-5 w-5 text-indigo-600 focus:ring-indigo-500">
            <span class="ml-2 text-base text-gray-700">อื่นๆ</span>
          </label>
        </div>
        <div id="otherPrefixInput" class="hidden mt-2">
          <input type="text" id="otherPrefixText" placeholder="ระบุคำนำหน้า"
                 class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-base p-2">
        </div>
      </div>

      <!-- ชื่อ-นามสกุล -->
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
        <div>
          <label for="firstName" class="block text-base font-medium text-gray-700">ชื่อ (ภาษาไทย) <span class="text-red-500">*</span></label>
          <input type="text" id="firstName" required
                 class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-base p-2">
        </div>
        <div>
          <label for="lastName" class="block text-base font-medium text-gray-700">นามสกุล (ภาษาไทย) <span class="text-red-500">*</span></label>
          <input type="text" id="lastName" required
                 class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-base p-2">
        </div>
      </div>

      <!-- รหัสพนักงาน & Department -->
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
        <div>
          <label for="employeeId" class="block text-base font-medium text-gray-700">รหัสพนักงาน <span class="text-red-500">*</span></label>
          <input type="text" id="employeeId" required
                 class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-base p-2">
        </div>
        <div>
          <label for="department" class="block text-base font-medium text-gray-700">Department <span class="text-red-500">*</span></label>
          <select id="department" required
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-base p-2">
            <option value="">โปรดเลือก</option>
            <option value="Accounting Division">Accounting Division</option>
            <option value="Business Development">Business Development</option>
            <option value="Human Resources">Human Resources</option>
            <option value="Information Technology">Information Technology</option>
            <option value="Leasing & Tenant">Leasing & Tenant</option>
            <option value="Legal">Legal</option>
            <option value="Local Area Marketing">Local Area Marketing</option>
            <option value="Maintenance">Maintenance</option>
            <option value="Management">Management</option>
            <option value="Marketing">Marketing</option>
            <option value="Programming & film">Programming & film</option>
            <option value="Operation">Operation</option>
            <option value="Project">Project</option>
            <option value="Purchasing">Purchasing</option>
            <option value="Other">Other</option>
          </select>
        </div>
      </div>

      <!-- วันที่และเวลาอบรม -->
      <div>
        <label class="block text-base font-medium text-gray-700">โปรดเลือก วันที่และเวลาเข้าอบรม <span class="text-red-500">*</span></label>
        <select id="trainingDate" required
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-base p-2">
          <option value="">โปรดเลือก</option>
          <option value="วันที่ 29 กันยายน 2568 เวลา 10.00-17.00 น.">วันที่ 29 กันยายน 2568 เวลา 10.00-17.00 น.</option>
        </select>
      </div>

      <!-- Notebook -->
      <div>
        <label class="block text-base font-medium text-gray-700">ท่านมี Notebook หรือไม่ ? (ใช้สำหรับ Workshop) <span class="text-red-500">*</span></label>
        <div class="mt-2 flex items-center space-x-4">
          <label class="flex items-center">
            <input type="radio" name="hasNotebook" value="มี" class="h-5 w-5 text-indigo-600 focus:ring-indigo-500" required>
            <span class="ml-2 text-base text-gray-700">มี</span>
          </label>
          <label class="flex items-center">
            <input type="radio" name="hasNotebook" value="ไม่มี" id="noNotebookRadio" class="h-5 w-5 text-indigo-600 focus:ring-indigo-500">
            <span class="ml-2 text-base text-gray-700">ไม่มี</span>
          </label>
        </div>

        <!-- ตัวเลือกเสริมเมื่อไม่มี Notebook -->
        <div id="noNotebookOptions" class="hidden mt-4 pl-8 border-l-2 border-gray-200">
          <label class="block text-base font-medium text-gray-700 mb-2">ท่านต้องการให้ทีมงานจัดเตรียม Notebook ให้หรือไม่?</label>
          <div class="flex items-center space-x-4">
            <label class="flex items-center">
              <input type="radio" name="requestNotebook" value="ต้องการ" class="h-5 w-5 text-indigo-600 focus:ring-indigo-500">
              <span class="ml-2 text-base text-gray-700">ต้องการ <span class="text-red-500 text-xs font-bold">(มีจำนวนจำกัด)</span></span>
            </label>
            <label class="flex items-center">
              <input type="radio" name="requestNotebook" value="ไม่ต้องการ" class="h-5 w-5 text-indigo-600 focus:ring-indigo-500">
              <span class="ml-2 text-base text-gray-700">ไม่ต้องการ</span>
            </label>
          </div>
        </div>
      </div>

      <button type="submit"
              class="w-full py-3 rounded-xl bg-indigo-600 text-white font-semibold hover:bg-indigo-700 transition">
        ส่งแบบฟอร์ม
      </button>
    </form>

    <p class="text-xs text-gray-400 mt-6 text-center">
      เมื่อกด “ส่งแบบฟอร์ม” ข้อมูลจะถูกส่งไปยัง Google Apps Script (REST API) และบันทึกลง Google Sheet
    </p>
  </div>

  <script>
    // --- CONFIG: ใส่ Web App URL ของคุณ ---
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycby_IOodCljW1JtUZ-RQeqA-YiED9SIxtRaBjk7V1QJsrR6XWHlwNCeiK8FQhKQ0Q5-3/exec";
    // (ถ้าตั้ง token ใน GAS) เพิ่มใน payload: token: "YOUR_SECRET"

    // แสดง/ซ่อน "อื่นๆ" ของคำนำหน้า
    document.querySelectorAll('input[name="prefix"]').forEach(r => {
      r.addEventListener('change', () => {
        const isOther = document.getElementById('otherPrefix').checked;
        document.getElementById('otherPrefixInput').classList.toggle('hidden', !isOther);
      });
    });

    // แสดง/ซ่อนตัวเลือกโน้ตบุ๊กเมื่อเลือก "ไม่มี"
    const noNbRadio = document.getElementById('noNotebookRadio');
    const hasNbYes = document.querySelector('input[name="hasNotebook"][value="มี"]');
    [noNbRadio, hasNbYes].forEach(el => el.addEventListener('change', toggleNotebookOptions));
    function toggleNotebookOptions(){
      const show = noNbRadio.checked;
      document.getElementById('noNotebookOptions').classList.toggle('hidden', !show);
    }

    // ส่งฟอร์มด้วย fetch → GAS doPost (Content-Type: text/plain)
    document.getElementById('registrationForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      // คำนำหน้า
      const prefixChecked = document.querySelector('input[name="prefix"]:checked');
      let prefix = prefixChecked ? prefixChecked.value : '';
      if (document.getElementById('otherPrefix').checked) {
        const otherText = (document.getElementById('otherPrefixText').value || '').trim();
        if (otherText) prefix = otherText;
      }

      // ค่าฟิลด์อื่นๆ
      const firstName   = document.getElementById('firstName').value.trim();
      const lastName    = document.getElementById('lastName').value.trim();
      const employeeId  = document.getElementById('employeeId').value.trim();
      const department  = document.getElementById('department').value;
      const trainingDate= document.getElementById('trainingDate').value;

      const hasNotebookStr = (document.querySelector('input[name="hasNotebook"]:checked')?.value || '');
      const hasNotebook = hasNotebookStr === 'มี'; // แปลงเป็น boolean

      const requestNotebook = (document.querySelector('input[name="requestNotebook"]:checked')?.value || '');

      // ตรวจความครบถ้วนฝั่ง client
      if (!prefix || !firstName || !lastName || !employeeId || !department || !trainingDate || hasNotebookStr === '') {
        Swal.fire('กรอกไม่ครบ', 'กรุณากรอกข้อมูลที่มี * ให้ครบ', 'warning');
        return;
      }

      const payload = {
        prefix, firstName, lastName, employeeId, department, trainingDate,
        hasNotebook, requestNotebook
        // , token: "YOUR_SECRET"
      };

      try {
        Swal.fire({title:'กำลังบันทึก...', allowOutsideClick:false, didOpen:()=>Swal.showLoading()});
        const res = await fetch(WEB_APP_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'text/plain;charset=utf-8' }, // ✅ เลี่ยง preflight
          body: JSON.stringify(payload)
        });
        const json = await res.json();
        Swal.close();

        if (json.status === 'success' || json.ok) {
          Swal.fire('สำเร็จ', json.message || 'บันทึกเรียบร้อย', 'success');
          e.target.reset();
          document.getElementById('otherPrefixInput').classList.add('hidden');
          document.getElementById('noNotebookOptions').classList.add('hidden');
        } else {
          Swal.fire('ผิดพลาด', json.message || 'บันทึกไม่สำเร็จ', 'error');
        }
      } catch (err) {
        Swal.close();
        Swal.fire('ผิดพลาด', 'เครือข่ายหรือเซิร์ฟเวอร์มีปัญหา: ' + err.message, 'error');
      }
    });
  </script>
</body>
</html>
